<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<title>ExtJs</title></head>
<body>

<h1 style="font-size:2.5em; margin:1em 0px 15px; line-height:1.7; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
WSGI 简介</h1>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E8%83%8C%E6%99%AF" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E8%83%8C%E6%99%AF" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>背景</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
Python Web 开发中，服务端程序可以分为两个部分，一是服务器程序，二是应用程序。前者负责把客户端请求接收，整理，后者负责具体的逻辑处理。为了方便应用程序的开发，我们把常用的功能封装起来，成为各种Web开发框架，例如 Django, Flask, Tornado。不同的框架有不同的开发方式，但是无论如何，开发出的应用程序都要和服务器程序配合，才能为用户提供服务。这样，服务器程序就需要为不同的框架提供不同的支持。这样混乱的局面无论对于服务器还是框架，都是不好的。对服务器来说，需要支持各种不同框架，对框架来说，只有支持它的服务器才能被开发出的应用使用。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这时候，标准化就变得尤为重要。我们可以设立一个标准，只要服务器程序支持这个标准，框架也支持这个标准，那么他们就可以配合使用。一旦标准确定，双方各自实现。这样，服务器可以支持更多支持标准的框架，框架也可以使用更多支持标准的服务器。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
Python Web开发中，这个标准就是&nbsp;<span style="">The Web Server Gateway Interface</span>, 即&nbsp;<span style="">WSGI</span>. 这个标准在<a target="_blank" target="_blank" href="http://www.python.org/dev/peps/pep-0333/" style="color:rgb(65,131,196); text-decoration:none">PEP 333</a>中描述，后来，为了支持
 Python 3.x, 并且修正一些问题，新的版本在<a target="_blank" target="_blank" href="http://www.python.org/dev/peps/pep-3333/" style="color:rgb(65,131,196); text-decoration:none">PEP 3333</a>中描述。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="wsgi-%E6%98%AF%E4%BB%80%E4%B9%88" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#wsgi-%E6%98%AF%E4%BB%80%E4%B9%88" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>WSGI
 是什么</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI 是服务器程序与应用程序的一个约定，它规定了双方各自需要实现什么接口，提供什么功能，以便二者能够配合使用。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI 不能规定的太复杂，否则对已有的服务器来说，实现起来会困难，不利于WSGI的普及。同时WSGI也不能规定的太多，例如cookie处理就没有在WSGI中规定，这是为了给框架最大的灵活性。要知道WSGI最终的目的是为了方便服务器与应用程序配合使用，而不是成为一个Web框架的标准。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另一方面，WSGI需要使得middleware（是中间件么？）易于实现。middleware处于服务器程序与应用程序之间，对服务器程序来说，它相当于应用程序，对应用程序来说，它相当于服务器程序。这样，对用户请求的处理，可以变成多个 middleware 叠加在一起，每个middleware实现不同的功能。请求从服务器来的时候，依次通过middleware，响应从应用程序返回的时候，反向通过层层middleware。我们可以方便地添加，替换middleware，以便对用户请求作出不同的处理。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="wsgi-%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#wsgi-%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>WSGI
 内容概要</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI主要是对应用程序与服务器端的一些规定，所以，它的主要内容就分为两个部分。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>应用程序</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI规定：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">1. 应用程序需要是一个可调用的对象
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
在Python中:</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">可以是函数</li><li style="">可以是一个实例，它的类实现了<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">__call__</code>方法</li><li style="">可以是一个类，这时候，用这个类生成实例的过程就相当于调用这个类</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
同时，WSGI规定：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">2. 可调用对象接收两个参数
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这样，如果这个对象是函数的话，它看起来要是这个样子：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal"># callable function
def application(environ, start_response):
    pass
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果这个对象是一个类的话，它看起来是这个样子：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal"># callable class
class Application:
    def __init__(self, environ, start_response):
        pass
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果这个对象是一个类的实例，那么，这个类看起来是这个样子：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal"># callable object
class ApplicationObj:
    def __call__(self, environ, start_response):
        pass
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
最后，WSGI还规定:</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">3.可调用对象要返回一个&#20540;，这个&#20540;是可迭代的。
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这样的话，前面的三个例子就变成：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">HELLO_WORLD = b&quot;Hello world!\n&quot;


# callable function
def application(environ, start_response):
    return [HELLO_WORLD]


# callable class
class Application:
    def __init__(self, environ, start_response):
        pass

    def __iter__(self):
        yield HELLO_WORLD


# callable object
class ApplicationObj:
    def __call__(self, environ, start_response):
        return [HELLO_WORLD]
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
你可能会说，不是啊，我们平时写的web程序不是这样啊。 比如如果使用web.py框架的话，一个典型的应用可能是这样的:</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">class hello:
    def GET(self):
        return 'Hello, world!'
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这是由于框架已经把WSGI中规定的一些东西封装起来了，我们平时用框架时，看不到这些东西，只需要直接实现我们的逻辑，再返回一个&#20540;就好了。其它的东西框架帮我们做好了。这也是框架的价&#20540;所在，把常用的东西封装起来，让使用者只需要关注最重要的东西。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
当然，<span style="">WSGI关于应用程序的规定不只这些</span>，但是现在，我们只需要知道这些就足够了。下面，再介绍服务器程序。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>服务器程序</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
服务器程序会在每次客户端的请求传来时，调用我们写好的应用程序，并将处理好的结果返回给客户端。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI规定：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">4.服务器程序需要调用应用程序
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
服务器程序看起来大概是这个样子的：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">def run(application):
    environ = {}

    def start_response(status, response_headers, exc_info=None):
        pass

    result = application(environ, start_response)

    def write(data):
        pass

    for data in result:
        write(data)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这里可以看出服务器程序是如何与应用程序配合完成用户请求的。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI规定了应用程序需要一个可调用对象，有两个参数，返回一个可迭代对象。在服务器 程序中，针对这几个规定，做了以下几件事：</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">把应用程序需要的两个参数设置好</li><li style="">调用应用程序</li><li style="">迭代访问应用程序的返回结果，并将其传回客户端</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
你可以从中发现，应用程序需要的两个参数，一个是一个dict对象，一个是函数。它们到底有什么用呢？这都不是我们现在应该关心的，现在只需要知道，服务器程序大概做了什么事情就好了，后面，我们会深入讨论这些细节。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="middleware" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#middleware" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>middleware</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，有些功能可能介于服务器程序和应用程序之间，例如，服务器拿到了客户端请求的URL, 不同的URL需要交由不同的函数处理，这个功能叫做 URL Routing，这个功能就可以放在二者中间实现，这个中间层就是 middleware。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
middleware对服务器程序和应用是透明的，也就是说，服务器程序以为它就是应用程序，而应用程序以为它就是服务器。这就告诉我们，middleware需要把自己伪装成一个服务器，接受应用程序，调用它，同时middleware还需要把自己伪装成一个应用程序，传给服务器程序。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
其实无论是服务器程序，middleware 还是应用程序，都在服务端，为客户端提供服务，之所以把他们抽象成不同层，就是为了控制复杂度，使得每一次都不太复杂，各司其职。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
下面，我们看看middleware大概是什么样子的。</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal"># URL Routing middleware
def urlrouting(url_app_mapping):
    def midware_app(environ, start_response):
        url = environ['PATH_INFO']
        app = url_app_mapping[url]

        result = app(environ, start_response)

        return result

    return midware_app
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
函数&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">midware_app</code>就是一个简单的middleware：对服务器而言，它是一个应用程序，是一个可调用对象，
 有两个参数，返回一个可调用对象。对应用程序而言，它是一个服务器，为应用程序提供了参数，并且调用了应用程序。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，这里的<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">urlrouting</code>函数，相当于一个函数生成器，你给它不同的 url-app
 映射关系，它会生成相应的具有 url routing功能的 middleware。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果你仅仅想简单了解一下WSGI是什么，相信到这里，你差不多明白了，下面会介绍WSGI的细节，这些细节来自&nbsp;<a target="_blank" target="_blank" href="http://www.python.org/dev/peps/pep-3333/" style="color:rgb(65,131,196); text-decoration:none">PEP3333</a>， 如果没有兴趣，到这里&nbsp;<span style="">可以停止</span>了。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="wsgi%E8%AF%A6%E8%A7%A3" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#wsgi%E8%AF%A6%E8%A7%A3" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>WSGI详解</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
注意：以 点 开始的解释是WSGI规定&nbsp;<span style="">必须满足</span>&nbsp;的。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-1" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-1" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>应用程序</h3>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">应用程序是可调用对象</li><li style="">可调用对象有两个位置参数<br style="">
所谓位置参数就是调用的时候，依靠位置来确定参数的语义，而不是参数名，也就是说服务 器调用应用程序时，应该是这样：</li></ul>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">application(env, start_response)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
而不是这样：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">application(start_response=start_response, environ=env)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
所以，参数名其实是可以随便起的，只不过为了表义清楚，我们起了<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">environ</code>&nbsp;和&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">start_response</code>。</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">第一个参数environ是Python内置的dict对象，应用程序可以对这个参数任意修改。</li><li style="">environ参数必须包含 WSGI 需要的一些变量(详见后文)<br style="">
也可以包含一些扩展参数，命名规范见后文</li><li style="">start_response参数是一个可调用对象。接受两个位置参数，一个可选参数。 例如：<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">start_response(status,
 response_headers, exc_info=None)&nbsp;</code>status参数是状态码，例如&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">200
 OK</code>&nbsp;。</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
response_headers参数是一个列表，列表项的形式为(header_name, header_value)。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
exc_info参数在错误处理的时候使用。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
status和response_headers的具体内容可以参考&nbsp;<a target="_blank" target="_blank" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6" style="color:rgb(65,131,196); text-decoration:none">HTTP 协议 Response部分</a>。</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">start_response必须返回一个可调用对象：&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">write(body_data)</code></li><li style="">应用程序必须返回一个可迭代对象。</li><li style="">应用程序不应假设返回的可迭代对象被遍历至终止，因为遍历过程可能出现错误。</li><li style="">应用程序必须在第一次返回可迭代数据之前调用 start_response 方法。<br style="">
这是因为可迭代数据是 返回数据的&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">body</code>&nbsp;部分，在它返回之前，需要使用&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">start_response</code>&nbsp;返回
 response_headers 数据。</li></ul>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F-1" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A8%8B%E5%BA%8F-1" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>服务器程序</h3>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">服务器必须将可迭代对象的内容传递给客户端，可迭代对象会产生bytestrings，必须完全完成每个bytestring后才能请求下一个。</li><li style="">假设result 为应用程序的返回的可迭代对象。如果len(result) 调用成功，那么result必须是可累积的。</li><li style="">如果result有<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">close</code>方法，那么每次完成对请求的处理时，必须调用它，无论这次请求正常完成，还是遇到了错误。</li><li style="">服务器程序禁止使用可迭代对象的其它属性，除非这个可迭代对象是一个特殊类的实例，这个类会被&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">wsgi.file_wrapper</code>定义。</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
根据上述内容，我们的服务器程序看起来会是这个样子：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">def run(application):
    environ = {}

    # set environ
    def write(data):
        pass

    def start_response(status, response_headers, exc_info=None):
        return write

    try:
        result = application(environ, start_response)
    finally:
        if hasattr(result, 'close'):
            result.close()

    if hasattr(result, '__len__'):
        # result must be accumulated
        pass


    for data in result:
        write(data)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
应用程序看起来是这个样子：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">HELLO_WORLD = b&quot;Hello world!\n&quot;


# callable function
def application(environ, start_response):
    status = '200 OK'
    response_headers = [('Content-type', 'text/plain')]
    start_response(status, response_headers)

    return [HELLO_WORLD]

</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
下面我们再详细介绍之前提到的一些数据结构</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="environ-%E5%8F%98%E9%87%8F" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#environ-%E5%8F%98%E9%87%8F" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>environ
 变量</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
environ 变量需要包含 CGI 环境变量，它们在<a target="_blank" target="_blank" href="http://tools.ietf.org/html/draft-robinson-www-interface-00" style="color:rgb(65,131,196); text-decoration:none">The Common Gateway Interface Specification</a>&nbsp;中定义，下面列出的变量<span style="">必须</span>包含在
 enciron变量中：</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">REQUEST_METHOD<br style="">
HTTP 请求方法，例如 &quot;GET&quot;, &quot;POST&quot;</li><li style="">SCRIPT_NAME<br style="">
URL 路径的起始部分对应的应用程序对象，如果应用程序对象对应服务器的根，那么这个&#20540;可以为空字符串</li><li style="">PATH_INFO<br style="">
URL 路径除了起始部分后的剩余部分，用于找到相应的应用程序对象，如果请求的路径就是根路径，这个&#20540;为空字符串</li><li style="">QUERY_STRING<br style="">
URL路径中&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">?</code>&nbsp;后面的部分</li><li style="">CONTENT_TYPE<br style="">
HTTP 请求中的&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">Content-Type</code>&nbsp;部分</li><li style="">CONTENT_LENGTH<br style="">
HTTP 请求中的<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">Content-Lengh</code>&nbsp;部分</li><li style="">SERVER_NAME, SERVER_PORT<br style="">
与 SCRIPT_NAME，PATH_INFO 共同构成完整的 URL，它们永远不会为空。但是，如果 HTTP_HOST 存在的话，当构建 URL 时， HTTP_HOST优先于SERVER_NAME。</li><li style="">SERVER_PROTOCOL<br style="">
客户端使用的协议，例如 &quot;HTTP/1.0&quot;, &quot;HTTP/1.1&quot;, 它决定了如何处理 HTTP 请求的头部。这个名字其实应该叫<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">REQUEST_PROTOCOL</code>，因为它表示的是客户端请求的协议，而不是服务端响应的协议。但是为了和CGI兼容，我们只好叫这个名字了。
 *HTTP_ Variables<br style="">
这个是一个系列的变量名，都以<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">HTTP</code>开头，对应客户端支持的HTTP请求的头部信息。</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI 有一个参考实现，叫 wsgiref，里面有一个示例，我们这里引用这个示例的结果，展现一下这些变量，以便有一个直观的体会，这个示例访问的 URL 为&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">http://localhost:8000/xyz?abc</code></p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
上面提到的变量&#20540;为：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">REQUEST_METHOD = 'GET'
SCRIPT_NAME = ''
PATH_INFO = '/xyz'
QUERY_STRING = 'abc'
CONTENT_TYPE = 'text/plain'
CONTENT_LENGTH = ''
SERVER_NAME = 'minix-ubuntu-desktop'
SERVER_PORT = '8000'
SERVER_PROTOCOL = 'HTTP/1.1'

HTTP_ACCEPT = 'text/html,application/xhtml&#43;xml,application/xml;q=0.9,image/webp,*/*;q=0.8'
HTTP_ACCEPT_ENCODING = 'gzip,deflate,sdch'
HTTP_ACCEPT_LANGUAGE = 'en-US,en;q=0.8,zh;q=0.6,zh-CN;q=0.4,zh-TW;q=0.2'
HTTP_CONNECTION = 'keep-alive'
HTTP_HOST = 'localhost:8000'
HTTP_USER_AGENT = 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36'
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，服务器还应该（非必须）提供尽可能多的CGI变量，如果支持SSL的话，还应该提供<a target="_blank" target="_blank" href="http://www.modssl.org/docs/2.8/ssl_reference.html#ToC25" style="color:rgb(65,131,196); text-decoration:none">Apache SSL 环境变量</a>。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
服务器程序应该在文档中对它提供的变量进行说明，应用程序应该检查它需要的变量是否存在。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
除了 CGI 定义的变量外，服务器程序还可以包含和操作系统相关的环境变量，但这并非必须。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
但是，下面列出的这些 WSGI 相关的变量必须要包含：</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">wsgi.version<br style="">
&#20540;的形式为 (1, 0) 表示 WSGI 版本 1.0</li><li style="">wsgi.url_scheme<br style="">
表示 url 的模式，例如 &quot;https&quot; 还是 &quot;http&quot;</li><li style="">wsgi.input<br style="">
输入流，HTTP请求的 body 部分可以从这里读取</li><li style="">wsgi.erros<br style="">
输出流，如果出现错误，可以写往这里</li><li style="">wsgi.multithread<br style="">
如果应用程序对象可以被同一进程中的另一线程同时调用，这个&#20540;为True</li><li style="">wsgi.multiprocess<br style="">
如果应用程序对象可以同时被另一个进程调用，这个&#20540;为True</li><li style="">wsgi.run_once<br style="">
如果服务器希望应用程序对象在包含它的进程中只被调用一次，那么这个&#20540;为True</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这些&#20540;在 wsgiref示例中的&#20540;为：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">wsgi.errors = &lt;open file '&lt;stderr&gt;', mode 'w' at 0xb735f0d0&gt;
wsgi.file_wrapper = &lt;class wsgiref.util.FileWrapper at 0xb70525fc&gt;
wsgi.input = &lt;socket._fileobject object at 0xb7050e6c&gt;
wsgi.multiprocess = False
wsgi.multithread = True
wsgi.run_once = False
wsgi.url_scheme = 'http'
wsgi.version = (1, 0)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，environ中还可以包含服务器自己定义的一些变量，这些变量应该只包含</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">小写字母</li><li style="">数字</li><li style="">点</li><li style="">下划线</li><li style="">独立的前缀</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
例如，mod_python定义的变量名应该为mod_python.var_name的形式。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E8%BE%93%E5%85%A5%E6%B5%81%E5%8F%8A%E9%94%99%E8%AF%AF%E6%B5%81input-and-error-streams" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E8%BE%93%E5%85%A5%E6%B5%81%E5%8F%8A%E9%94%99%E8%AF%AF%E6%B5%81input-and-error-streams" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>输入流及错误流(Input
 and Error Streams)</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
服务器程序提供的输入流及错误流必须包含以下方法：</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">read(size)</li><li style="">readline()</li><li style="">readlines(hint)</li><li style=""><span style="">iter</span>()</li><li style="">flush()</li><li style="">write()</li><li style="">writelines(seq)</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
应用程序使用输入流对象及错误流对象时，只能使用这些方法，禁止使用其它方法，特别是， 禁止应用程序关闭这些流。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="start_response" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#start_response" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>start_response()</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
start_response是HTTP响应的开始，它的形式为：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">start_response(status, response_headers, exc_info=None)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
返回一个可调用对象，这个可调用对象形式为：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">write(body_data)
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
status 表示 HTTP 状态码，例如 &quot;200 OK&quot;, &quot;404 Not Found&quot;，它们在&nbsp;<a target="_blank" target="_blank" href="http://www.faqs.org/rfcs/rfc2616.html" style="color:rgb(65,131,196); text-decoration:none">RFC 2616</a>中定义，status禁止包含控制字符。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
response_headers 是一个列表，列表项是一个二元组： (header_name, heaer_value) ， 每个 header_name 都必须是&nbsp;<a target="_blank" target="_blank" href="http://www.faqs.org/rfcs/rfc2616.html" style="color:rgb(65,131,196); text-decoration:none">RFC 2616</a>&nbsp;4.2 节中定义的HTTP 头部名。header_value
 禁止包含控制字符。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，服务器程序必须保证正确的headers 被返回给客户端，如果应用程序没有返回headers，服务器必须添加它。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
应用程序和middleware禁止使用 HTTP/1.1 中的 &quot;hop-by-hop&quot;特性，以及其它可能影响客户端与服务器永久连接的特性。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
start_response 被调用时，服务器应该检查 headers 中的错误，另外，禁止 start_response直接将 response_headers传递给客户端，它必须把它们存储起来，一直到应用程序第一次迭代返回一个非空数据后，才能将response_headers传递给客户端。这其实是在说，HTTP响应body部分必须有数据，不能只返回一个header。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
start_response的第三个参数是一个可选参数，exc_info，它必须和Python的 sys.exc_info()返回的数据有相同类型。当处理请求的过程遇到错误时，这个参数会被设置，同时调用 start_response。如果提供了exc_info，但是HTTP headers 还没有输出，那么 start_response需要将当前存储的 HTTP response headers替换成一个新&#20540;。但是，如果提供了exc_info，同时 HTTP headers已经输出了，那么 start_response
 必须 raise 一个 error。禁止应用程序处理 start_response raise出的 exceptions，应该交给服务器程序处理。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
当且仅当提供 exc_info参数时，start_response才可以被调用多于一次。换句话说，要是没提供这个参数，start_response在当前应用程序中调用后，禁止再调用。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
为了避免循环引用，start_response实现时需要保证 exc_info在函数调用后不再包含引用。 也就是说start_response用完 exc_info后，需要保证执行一句</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">exc_info = None
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这可以通过 try/finally实现。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E5%A4%84%E7%90%86-content-length-header" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E5%A4%84%E7%90%86-content-length-header" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>处理
 Content-Length Header</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果应用程序支持 Content-Length，那么服务器程序传递的数据大小不应该超过 Content-Length，当发送了足够的数据后，应该停止迭代，或者 raise 一个 error。当然，如果应用程序返回的数据大小没有它指定的Content-Length那么多，那么服务器程序应该关闭连接，使用Log记录，或者报告错误。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果应用程序不支持Content-Length,那么服务器程序应该选择一种方法处理这种情况。最简单的方法就是当响应完成后，关闭与客户端的连接。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E7%BC%93%E5%86%B2%E4%B8%8E%E6%B5%81buffering-and-streaming" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E7%BC%93%E5%86%B2%E4%B8%8E%E6%B5%81buffering-and-streaming" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>缓冲与流(Buffering
 and Streaming)</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
一般情况下，应用程序会把需要返回的数据放在缓冲区里，然后一次性发送出去。之前说的应用程序会返回一个可迭代对象，多数情况下，这个可迭代对象，都只有一个元素，这个元素包含了HTML内容。但是在有些情况下，数据太大了，无法一次性在内存中存储这些数据，所以就需要做成一个可迭代对象，每次迭代只发送一块数据。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
禁止服务器程序延迟任何一块数据的传送，要么把一块数据完全传递给客户端，要么保证在产生下一块数据时，继续传递这一块数据。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="middleware-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#middleware-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>middleware
 处理数据</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果 middleware调用的应用程序产生了数据，那么middleware至少要产生一个数据，即使它想等数据积累到一定程度再返回，它也需要产生一个空的bytestring。 注意，这也意味着只要middleware调用的应用程序产生了一个可迭代对象，middleware也必须返回一个可迭代对象。 同时，禁止middleware使用可调用对象write传递数据，write是middleware调用的应用程序使用的。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="write-%E5%8F%AF%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#write-%E5%8F%AF%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>write
 可调用对象</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
一些已经存在的应用程序框架使用了write函数或方法传递数据，并且没有使用缓冲区。不幸的是，根据WSGI中的要求，应用程序需要返回可迭代对象，这样就无法实现这些API,为了允许这些API 继续使用，WSGI要求 start_response 返回一个 write 可调用对象，这样应用程序就能使用这个 write 了。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
但是，如果能避免使用这个 write，最好避免使用，这是为兼容以前的应用程序而设计的。这个write的参数是HTTP response body的一部分，这意味着在write()返回前，必须保证传给它的数据已经完全被传送了，或者已经放在缓冲区了。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
应用程序必须返回一个可迭代对象，即使它使用write产生HTTP response body。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这里可以发现，有两中传递数据的方式，一种是直接使用write传递，一种是应用程序返回可迭代对象后，再将这个可迭代对象传递，如果同时使用这两种方式，前者的数据必须在后者之前传递。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="unicode" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#unicode" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>Unicode</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
HTTP 不支持 Unicode, 所有编码/解码都必须由应用程序完成，所有传递给或者来自server的字符串都必须是&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">str</code>&nbsp;或者<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">bytes</code>类型，而不是<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">unicode</code>。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
注意传递给start_response的数据，其编码都必须遵循&nbsp;<a target="_blank" target="_blank" href="http://www.faqs.org/rfcs/rfc2616.html" style="color:rgb(65,131,196); text-decoration:none">RFC 2616</a>， 即使用 ISO-8859-1 或者&nbsp;<a target="_blank" target="_blank" href="http://www.faqs.org/rfcs/rfc2047.html" style="color:rgb(65,131,196); text-decoration:none">RFC
 2047</a>&nbsp;MIME 编码。</p>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
WSGI 中据说的&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">bytestrings</code>&nbsp;， 在Python3中指&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">bytes</code>，在以前的Python版本中，指&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">str</code>。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86error-handling" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86error-handling" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>错误处理(Error
 Handling)</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
应用程序应该捕获它们自己的错误，internal erros， 并且将相关错误信息返回给浏览器。 WSGI 提供了一种错误处理的方式，这就是之前提到的 exc_info参数。下面是 PEP 3333中提供的一段示例：</p>
<pre style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:13px; margin-top:15px; margin-bottom:15px; background-color:rgb(248,248,248); border:1px solid rgb(221,221,221); line-height:19px; overflow:auto; padding:6px 10px; word-wrap:normal; color:rgb(51,51,51)"><code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px; padding:0px; border:none; background-color:transparent; word-wrap:normal">try:
    # regular application code here
    status = &quot;200 Froody&quot;
    response_headers = [(&quot;content-type&quot;, &quot;text/plain&quot;)]
    start_response(status, response_headers)
    return [&quot;normal body goes here&quot;]
except:
    # XXX should trap runtime issues like MemoryError, KeyboardInterrupt
    #     in a separate handler before this bare 'except:'...
    status = &quot;500 Oops&quot;
    response_headers = [(&quot;content-type&quot;, &quot;text/plain&quot;)]
    start_response(status, response_headers, sys.exc_info())
    return [&quot;error body goes here&quot;]
</code></pre>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
当出现异常时，start_response的exc_info参数被设置成 sys.exc_info()，这个函数会返回当前的异常。</p>
<h3 style="margin:1em 0px 15px; line-height:1.7; font-size:1.5em; padding:0px; position:relative; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="http-11-expectcontinue" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#http-11-expectcontinue" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>HTTP
 1.1 Expect/Continue</h3>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
如果服务器程序要实现 HTTP 1.1，那么它必须提供对 HTTP 1.1&nbsp;<code style="font-family:Consolas,'Liberation Mono',Courier,monospace; font-size:12px; margin:0px 2px; padding:0px 5px; border:1px solid rgb(221,221,221); background-color:rgb(248,248,248); white-space:nowrap">expect/continue</code>机制的支持。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E5%85%B6%E5%AE%83%E5%86%85%E5%AE%B9" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E5%85%B6%E5%AE%83%E5%86%85%E5%AE%B9" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>其它内容</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
在 PEP 3333 中，还包含了其它内容，例如：</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style="">HTTP 特性</li><li style="">线程支持</li><li style="">实现时需要注意的地方：包括，扩展API，应用程序配置，URL重建等</li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这里就不作过多介绍了。</p>
<h2 style="margin:1em 0px 15px; line-height:1.7; font-size:2em; padding:0px; position:relative; border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(238,238,238); color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif">
<a target="_blank" target="_blank" name="%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB" class="anchor" href="https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-26-wsgi-intro.md#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB" style="color:rgb(65,131,196); text-decoration:none; display:block; padding-right:6px; padding-left:30px; margin-left:-30px; position:absolute; top:0px; left:0px; bottom:0px"></a>扩展阅读</h2>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
这篇文章主要是我阅读 PEP 3333 后的理解和记录，有些地方可能没有理解正确或者没有写全，下面提供一些资源供扩展阅读。</p>
<ul style="padding:0px 0px 0px 30px; margin:15px 0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
<li style=""><a target="_blank" target="_blank" href="http://www.python.org/dev/peps/pep-3333/" style="color:rgb(65,131,196); text-decoration:none">PEP 3333</a><br style="">
不解释</li><li style=""><a target="_blank" target="_blank" href="http://wsgi.readthedocs.org/en/latest/" style="color:rgb(65,131,196); text-decoration:none">WSGI org</a><br style="">
看起来好像官方网站的样子，覆盖了关于WSGI的方方面面，包含学习资源，支持WSGI的框架列表，服务器列表，应用程序列表，middleware和库等等。</li><li style=""><a target="_blank" target="_blank" href="https://pypi.python.org/pypi/wsgiref" style="color:rgb(65,131,196); text-decoration:none">wsgiref</a><br style="">
WSGI的参考实现，阅读源代码后有利于对WSGI的理解。我在GitHub上有自己阅读后的注释版本，并且作了一些图，有需要可以看这里：<a target="_blank" target="_blank" href="https://github.com/minixalpha/SourceLearning/tree/master/wsgiref-0.1.2" style="color:rgb(65,131,196); text-decoration:none">wsgiref 源代码阅读</a></li></ul>
<p style="margin-top:15px; margin-bottom:15px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px">
另外，还有一些文章介绍了一些基本概念和一些有用的实例，非常不错。</p>
<ul style="padding:0px 0px 0px 30px; margin-top:15px; margin-right:0px; margin-left:0px; color:rgb(51,51,51); font-family:Helvetica,arial,freesans,clean,sans-serif; font-size:15.199999809265137px; line-height:20.399999618530273px; margin-bottom:0px!important">
<li style=""><a target="_blank" target="_blank" href="http://blog.kenshinx.me/blog/wsgi-research/" style="color:rgb(65,131,196); text-decoration:none">Wsgi研究</a></li><li style=""><a target="_blank" target="_blank" href="http://linluxiang.iteye.com/blog/799163" style="color:rgb(65,131,196); text-decoration:none">wsgi初探</a></li></ul>

</div>
</body>
</html>